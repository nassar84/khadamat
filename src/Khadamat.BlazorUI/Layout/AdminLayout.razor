@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject Khadamat.BlazorUI.Services.Auth.IAuthService AuthService

<div class="admin-layout" dir="rtl">
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay @(SidebarOpen ? "visible" : "")" @onclick="ToggleSidebar"></div>

    <aside class="admin-sidebar glass-card @(SidebarOpen ? "open" : "")">
        <div class="sidebar-header d-flex justify-content-between align-items-center">
            <h3 class="brand-name mb-0">خدمات <span class="badge">Admin</span></h3>
            <!-- Mobile Close Button -->
            <button class="btn btn-link text-muted d-lg-none" @onclick="ToggleSidebar">
                <i class="fas fa-times fs-5"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <NavLink class="nav-link" href="/admin" Match="NavLinkMatch.All" @onclick="CloseSidebar">
                <i class="fas fa-chart-line"></i> لوحة التحكم
            </NavLink>
            <NavLink class="nav-link" href="/admin/users" @onclick="CloseSidebar">
                <i class="fas fa-users"></i> المستخدمين
            </NavLink>
             <NavLink class="nav-link" href="/admin/services" @onclick="CloseSidebar">
                <i class="fas fa-briefcase"></i> الخدمات
            </NavLink>
             <NavLink class="nav-link" href="/admin/approvals/providers" @onclick="CloseSidebar">
                <i class="fas fa-user-check"></i> اعتماد مقدمي الخدمة
            </NavLink>
             <NavLink class="nav-link" href="/admin/approvals/services" @onclick="CloseSidebar">
                <i class="fas fa-clipboard-check"></i> اعتماد الخدمات
            </NavLink>
             <NavLink class="nav-link" href="/admin/categories" @onclick="CloseSidebar">
                <i class="fas fa-th-large"></i> التصنيفات
            </NavLink>
             <NavLink class="nav-link" href="/admin/locations" @onclick="CloseSidebar">
                <i class="fas fa-map-marker-alt"></i> المناطق
            </NavLink>
             <NavLink class="nav-link" href="/admin/ads" @onclick="CloseSidebar">
                <i class="fas fa-ad"></i> الإعلانات
            </NavLink>
             <NavLink class="nav-link" href="/admin/reports" @onclick="CloseSidebar">
                <i class="fas fa-file-alt"></i> التقارير
            </NavLink>
             <NavLink class="nav-link" href="/admin/logs" @onclick="CloseSidebar">
                <i class="fas fa-history"></i> سجل النشاط
            </NavLink>
             <NavLink class="nav-link" href="/admin/settings" @onclick="CloseSidebar">
                <i class="fas fa-cogs"></i> الإعدادات
            </NavLink>
             <NavLink class="nav-link" href="/admin/subscriptions" @onclick="CloseSidebar">
                <i class="fas fa-credit-card"></i> الاشتراكات
            </NavLink>
             <NavLink class="nav-link" href="/" @onclick="CloseSidebar">
                <i class="fas fa-home"></i> العودة للموقع
            </NavLink>
             <button class="nav-link btn-logout" @onclick="HandleLogout">
                <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
            </button>
        </nav>
    </aside>

    <main class="admin-content">
        <div class="admin-header glass-card">
            <div class="d-flex align-items-center gap-3">
                <!-- Mobile Toggle Button -->
                <button class="btn btn-link text-dark p-0 d-lg-none" @onclick="ToggleSidebar">
                    <i class="fas fa-bars fs-4"></i>
                </button>
                <h4 class="mb-0">لوحة التحكم</h4>
            </div>

            <div class="admin-user-info">
                 <AuthorizeView>
                    <Authorized>
                        <span class="d-none d-md-inline">مرحباً، @context.User.Identity?.Name</span>
                        <i class="fas fa-user-circle fs-4 d-md-none text-primary"></i>
                    </Authorized>
                </AuthorizeView>
            </div>
        </div>
        
        <div class="content-body">
            @Body
        </div>
    </main>
</div>

<style>
    .admin-layout {
        display: flex;
        min-height: 100vh;
        /* Background handled by global body style for consistency */
    }

    .admin-sidebar {
        width: 280px;
        margin: 20px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        border-radius: 20px;
        height: calc(100vh - 40px);
        position: sticky;
        top: 20px;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        background: rgba(255, 255, 255, 0.82);
    }

    .sidebar-header {
        margin-bottom: 30px;
        text-align: center;
    }

    .sidebar-nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .nav-link {
        color: #64748b;
        padding: 12px 15px;
        border-radius: 12px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .nav-link:hover, .nav-link.active {
        background: var(--theme-primary);
        color: white;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25); /* specific glow */
        transform: translateX(-5px);
    }
    
    .btn-logout {
        background: none;
        border: none;
        width: 100%;
        cursor: pointer;
        margin-top: auto;
        color: #ef4444;
    }
    
    .btn-logout:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        box-shadow: none;
        transform: none;
    }

    .admin-content {
        flex: 1;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: calc(100% - 320px); 
        overflow-x: hidden;
    }

    .admin-header {
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 15px;
    }

    .content-body {
        flex: 1;
    }
    
    .badge {
        font-size: 0.7rem;
        background: var(--theme-secondary);
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        vertical-align: middle;
    }

    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.3);
        backdrop-filter: blur(2px);
        z-index: 999;
        display: none;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .sidebar-overlay.visible {
        display: block;
        opacity: 1;
    }

    /* Mobile Responsive Styles */
    @@media (max-width: 991px) {
        .admin-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            margin: 0;
            width: 280px;
            border-radius: 20px 0 0 20px; /* Rounded only on open side */
            transform: translateX(110%); /* Hide (RTL: Move Right) */
            box-shadow: -5px 0 25px rgba(0,0,0,0.1);
        }

        .admin-sidebar.open {
            transform: translateX(0);
        }

        .admin-content {
            width: 100%;
            padding: 15px;
        }

        .admin-header {
            padding: 12px 15px;
        }
    }
</style>

@code {
    private bool SidebarOpen { get; set; } = false;

    private void ToggleSidebar()
    {
        SidebarOpen = !SidebarOpen;
    }

    private void CloseSidebar()
    {
        // Only relevant on mobile where sidebar overlays content
        SidebarOpen = false;
    }

    private async Task HandleLogout()
    {
        await AuthService.Logout();
        Navigation.NavigateTo("/login");
    }
}
