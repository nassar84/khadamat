@page "/categories"
@using Khadamat.Application.DTOs
@using Khadamat.BlazorUI.Services
@inject ApiClient Api
@inject NavigationManager Navigation

<div class="px-3 pt-3">
    <div class="d-flex align-items-center mb-4">
        <button class="btn btn-icon me-3" @onclick='() => Navigation.NavigateTo("/")'>
            <i class="fa-solid fa-arrow-right"></i>
        </button>
        <h3 class="fw-bold mb-0 gradient-text">كافة التصنيفات</h3>
    </div>

    @if (mainCategories == null)
    {
        <LoadingSpinner Message="جاري تحميل التصنيفات الرئيسية..." />
    }
    else if (!mainCategories.Any())
    {
        <div class="text-center py-5 opacity-50 bg-light rounded-4">
            <i class="fa-solid fa-layer-group fs-1 mb-3"></i>
            <p>لا توجد تصنيفات متاحة حالياً</p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var cat in mainCategories)
            {
                <div class="col-6 col-md-4 col-lg-3">
                    <MainCategoryCard Category="cat" OnClick="NavigateToCategory" />
                </div>
            }
        </div>
    }
</div>

@code {
    private List<MainCategoryDto>? mainCategories;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            mainCategories = await Api.GetMainCategoriesAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading categories: {ex.Message}");
            mainCategories = new List<MainCategoryDto>();
        }
    }

    private void NavigateToCategory(MainCategoryDto cat)
    {
        Navigation.NavigateTo($"/explore/main/{cat.Id}/{Uri.EscapeDataString(cat.Name)}");
    }
}
